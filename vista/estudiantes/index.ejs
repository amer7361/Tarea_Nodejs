<!DOCTYPE html>
<html lang="en">
<head>
  <title>Bootstrap Example</title>
  <meta charset = "UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/css/bootstrap.min.css" rel="stylesheet">
  <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/js/bootstrap.bundle.min.js"></script>
  <script src="https://code.jquery.com/jquery-3.5.1.slim.min.js" integrity="sha384-DfXdz2htPH0lsSSs5nCTpuj/zy4C+OGpamoFVy38MVBnE+IbbVYUew+OrCXaRkfj" crossorigin="anonymous"></script>
</head>
<body>
<!-- The Modal -->
<div class="modal fade" id="myModal">
    <div class="modal-dialog">
      <div class="modal-content">
  
        <!-- Modal Header -->
        <div class="modal-header">
          <h4 class="modal-title">Datos del Estudiante</h4>
          <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
        </div>
  
        <!-- Modal body -->
        <div class="modal-body">
            <form action="/crud_estudiantes">
                <div class="mb-3 mt-3">
                    <label for="text" class="form-label">Id:</label>
                    <input type="text" class="form-control" id="txt_id" name="txt_id" placeholder="0" readonly>
                  </div>
                <div class="mb-3 mt-3">
                  <label for="text" class="form-label">Carne:</label>
                  <input type="text" class="form-control" id="txt_carne" name="txt_carne" placeholder="E001" onchange="validacionCarne(this);" required>
                </div>
                <div class="mb-3">
                  <label for="text"  class="form-label">Nombres:</label>
                  <input type="text" class="form-control" id="txt_nombres" name="txt_nombres" placeholder="Ingrese nombres" required>
                </div>
                <div class="mb-3">
                  <label for="text" class="form-label">Apellidos:</label>
                  <input type="text" class="form-control" id="txt_apellidos" name="txt_apellidos" placeholder="Ingrese apellidos" required>
                </div>
                <div class="mb-3">
                    <label for="text" class="form-label">Direccion:</label>
                    <input type="text" class="form-control" id="txt_direccion" name="txt_direccion" placeholder="Ciudad" required>
                  </div>
                <div class="mb-3">
                    <label for="text" class="form-label">Telefono:</label>
                    <input type="text" class="form-control" id="txt_telefono" name="txt_telefono" placeholder="Ingrese telefono" required>
                    </div>
                <div class="mb-3">
                    <label for="text" class="form-label">Email:</label>
                    <input type="text" class="form-control" id="txt_email" name="txt_email" placeholder="Ingrese email" required>
                    </div>
                <div class="mb-3">
                    <label for="text" class="form-label">Tipo de Sangre:</label>
                    <select name="txt_tipo_sangre" id="txt_tipo_sangre" class="form-select" required>
                    <% sangre.forEach(sangre=>{ %>
                      <option value="<%=sangre.id_tipos_sangre%>"><%=sangre.sangre%></option>
                    <% }); %>
                    
                    </select>
                    
                     </div>  
                <div class="mb-3">
                    <label for="text" class="form-label">Fecha de nacimiento:</label>
                    <input type="datetime" class="form-control" id="txt_fecha_nacimiento" name="txt_fecha_nacimiento" placeholder="Ingrese fecha de nacimiento" required>
                    </div>
                    <button type="submit" class="btn btn-primary" name="btn_agregar" id="btn_agregar">Agregar</button>
                    <button type="submit" class="btn btn-warning" name="btn_modificar" id="btn_modificar">Modificar</button>
                    <button type="submit" class="btn btn-danger" name="btn_eliminar" id="btn_eliminar" onclick="javascripts:if(!confirm('Desea Eliminar este estudiante')) return false">Eliminar</button>

              </form>
        </div>
  
        <!-- Modal footer -->
        <div class="modal-footer">
          <button type="button" class="btn btn-danger" data-bs-dismiss="modal">Close</button>
        </div>
  
      </div>
    </div>
  </div>
<div class="container mt-3">
  <h2>Dark Striped Table</h2>
  <p>Combine .table-dark and .table-striped to create a dark, striped table:</p>  
  <button type="button" class="btn btn-primary" data-bs-toggle="modal" data-bs-target="#myModal" onclick="limpiarForm();">
    Nuevo
  </button>
  <br> <br>  
  <table class="table table-dark table-striped">
    <thead>
      <tr>
        <th>Carne</th>
        <th>Nombres</th>
        <th>Apellidos</th>
        <th>Direccion</th>
        <th>Telefono</th>
        <th>Correo</th>
        <th>Tipos de Sangre</th>
        <th>Fecha de Nacimiento</th>
      </tr>
    </thead>
    <tbody id="tabla_estudiantes">
    <% resultado.forEach((estudiante)=>{ %>
        <tr data-id_estudiante="<%=estudiante.id_estudiante%>" data-id_tipos_sangre="<%=estudiante.id_tipos_sangre%>"> 
            <td><%= estudiante.carne %></td>
            <td><%= estudiante.nombres %></td>
            <td><%= estudiante.apellidos %></td>
            <td><%= estudiante.direccion %></td>
            <td><%= estudiante.telefono %></td>
            <td><%= estudiante.correo_electronico %></td>
            <td><%= estudiante.sangre %></td>
            <td><%= estudiante.fecha_nacimiento %></td>
        </tr>
    <% }) %>
    </tbody>
  </table>
</div>
<script type="text/javascript">
$('#tabla_estudiantes').on('click','tr td', function(evt){
  var target;
  var id_estudiantes,carne,nombre,apellidos,direccion,telefono,correo_electronico,id_tipo_sangre,fecha_nacimiento;
  target = $(evt.target);
  id_estudiantes = target.parent().data('id_estudiante');
  id_tipo_sangre = target.parent().data('id_tipos_sangre');
  carne = target.parent("tr").find("td").eq(0).html();
  nombres = target.parent("tr").find("td").eq(1).html();
  apellidos = target.parent("tr").find("td").eq(2).html();
  direccion = target.parent("tr").find("td").eq(3).html();
  telefono = target.parent("tr").find("td").eq(4).html();
  correo_electronico = target.parent("tr").find("td").eq(5).html();
  fecha_nacimiento = target.parent("tr").find("td").eq(7).html();
  $('#txt_id').val(id_estudiantes);
  $('#txt_carne').val(carne);
  $('#txt_nombres').val(nombres);
  $('#txt_apellidos').val(apellidos);
  $('#txt_direccion').val(direccion);
  $('#txt_telefono').val(telefono);
  $('#txt_email').val(correo_electronico);
  $('#txt_tipo_sangre').val(id_tipo_sangre);
  $('#txt_fecha_nacimiento').val(fecha_nacimiento);
  $('#btn_agregar').hide();
  $('#btn_modificar').show();
  $('#btn_eliminar').show();
  $('#myModal').modal('show');
});

</script>

<script>
    $(document).ready(()=>{
       $("#btn_modificar").hide();
       $("#btn_eliminar").hide();
       $("#btn_agregar").show();
    });
</script>
<script>
    function validacionCarne(textbox) {
        const pattern = /(^E{1})([0-9]{3})$/;
      if (textbox.value === "") {
        textbox.setCustomValidity
          ('Ingrese el Carnet');
      } else if (!pattern.test(textbox.value)) {
        textbox.setCustomValidity
          ('Ingrese un carnet Valido: E001-E999');
      }else {
        textbox.setCustomValidity('');
    }
    return true;
    }
    function limpiarForm(){
      $("#txt_id").val(0);
        $("#txt_carne").val("");
        $("#txt_nombres").val("");
        $("#txt_apellidos").val("");
        $("#txt_direccion").val("");
        $("#txt_telefono").val("");
        $("#txt_email").val("");
        $("#txt_fecha_nacimiento").val("");
        $("#btn_agregar").show();
        $("#btn_modificar").hide();
        $("#btn_eliminar").hide();
    }
        
    
</script>

</body>
</html>